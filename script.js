(function(){var a={id:"PlurkSearch",config:{sort:{pos:"\u65e5\u671f",fav:"\u6309\u8b9a\u6578",rep:"\u8f49\u5657\u6578"},porn:{all:"\u5168\u90e8","true":"\u6210\u4eba","false":"\u975e\u6210\u4eba"},loop_sec:2E3,loop_safe:100,page_per_count:20},flag:{page:1,local:{},session:{}},temp:{Plurk:function(c){var b=document.createElement("div");b.innerHTML='\n                <div class="PlurkDiv">\n                    <div>\n                        '+c.content+"\n                        <hr>\n\n                        <div>\n                        \u3010"+
c.no+"\u3011"+a.func.PlurkDate(c.posted)+' / \u559c\u6b61\uff1a<span class="fav">'+c.favorite_count+'</span> / \u8f49\u5657\uff1a<span class="rep">'+c.replurkers_count+'</span> / <a href="https://www.plurk.com/p/'+parseInt(c.plurk_id).toString(36)+'" target="_blank">PLURK</a>\n\n                        </div>\n\n                    </div>\n                </div>';return b}},func:{Block:function(c){var b=document.createElement("div");document.body.prepend(b);b.innerHTML='<div style="\n                position: absolute;\n                height: 100px;\n                width: 100px;\n                top: calc(50% - 100px);\n                left: calc(50% - 100px);\n                border-radius: 50%;\n                border-top: 5px solid #aaa;"></div>';
b.style="\n                    overflow:hidden;\n                    width: 100%;\n                    height: 100%;\n                    z-index: 99;\n                    background: #000;\n                    position: absolute;\n                    opacity:1;\n                    transition-duration: "+c+"s;\n                    cursor: wait;\n                ";var e=0,d=setInterval(function(){e++;b.querySelector("div").style.transform="rotate("+e+"deg)"},1);setTimeout(function(){b.style.opacity=
0;setTimeout(function(){b.remove();clearInterval(d)},1E3*c)},1E3*c)},PageControl:function(){var c=a.PlurkApi.search_plurks.length;document.querySelectorAll('#PageBar [data-mode="PageChange"]').forEach(function(b){b.setAttribute("disabled","")});1*a.flag.page+1<=Math.ceil(c/a.config.page_per_count)&&document.querySelector('#PageBar [data-path="next"]').removeAttribute("disabled");0<(a.flag.page-1)*a.config.page_per_count&&document.querySelector('#PageBar [data-path="prev"]').removeAttribute("disabled");
a.PlurkApi.plurks.length<=a.config.page_per_count&&document.querySelectorAll('#PageBar [data-mode="PageChange"]').forEach(function(b){b.setAttribute("disabled","")})},PlurkList:function(c){var b=document.querySelector("#PlurkList").innerHTML="",e="",d=document.querySelectorAll('select[data-mode="ymdchange"]'),k=document.querySelector('select[data-mode="sort"]'),l=document.querySelector('select[data-mode="porn"]');b=d[3].value+"/"+d[4].value+"/"+d[5].value;e=d[0].value+"/"+d[1].value+"/"+d[2].value;
var g=[],f;for(f in c){var h=c[f];(new Date(h.posted)).getFullYear()<=parseInt(d[3].value)&&(new Date(h.posted)).getFullYear().toString()>=parseInt(d[0].value)&&(new Date(h.posted)).getMonth()+1<=parseInt(d[4].value)&&(new Date(h.posted)).getMonth()+1>=parseInt(d[1].value)&&(new Date(h.posted)).getDate()<=parseInt(d[5].value)&&(new Date(h.posted)).getDate()>=parseInt(d[2].value)&&(l.value===h.porn.toString()||"all"===l.value)&&g.push(h)}"fav"===k.value?g.sort(function(m,n){return n.favorite_count!==
m.favorite_count?n.favorite_count-m.favorite_count:n.replurkers_count-m.replurkers_count}):"rep"===k.value&&g.sort(function(m,n){return n.replurkers_count!==m.replurkers_count?n.replurkers_count-m.replurkers_count:n.favorite_count-m.favorite_count});console.log(g);a.PlurkApi.search_plurks=g;for(f in g)c=g[f],c.no=1*f+1,(a.flag.page-1)*a.config.page_per_count>=c.no||a.flag.page*a.config.page_per_count<c.no||document.querySelector("#PlurkList").appendChild(a.temp.Plurk(c));document.querySelector("#Progress").innerHTML=
e+"~"+b+"\u671f\u9593\u641c\u5c0b\u5b8c\u6210,\u5171"+g.length+"\u5657";a.func.PageControl()},SelectYMD:function(c,b,e){for(var d="",k="",l="",g=(new Date).getFullYear()-10;g<=(new Date).getFullYear();g++)d+="<option "+(g===(new Date).getFullYear()?"selected":"")+">"+g+"</option>";for(g=1;12>=g;g++)k+="<option "+(g===(parseInt(b)||(new Date).getMonth()+1)?"selected":"")+">"+g.toString().padStart(2,"0")+"</option>";for(g=1;g<=(new Date(c||(new Date).getFullYear(),b||(new Date).getMonth()+1,0)).getDate();g++)l+=
"<option "+(g===(parseInt(e)||(new Date).getDate())?"selected":"")+">"+g.toString().padStart(2,"0")+"</option>";return{y:d,m:k,d:l}},SelectHtml:function(c,b){var e="",d;for(d in c)e+='<option value="'+d+'" '+(d===b?"selected":"")+">"+c[d]+"</option>";return e},ChangeEvent:function(c){if(void 0===c)document.querySelectorAll('[data-event="ChangeEvent"]').forEach(function(b){a.flag.ChangeEventRegister=a.flag.ChangeEventRegister||[];-1===a.flag.ChangeEventRegister.indexOf(b.id)&&(console.log("register ChangeEvent"),
a.flag.ChangeEventRegister.push(b.id),b.addEventListener("change",a.func.ChangeEvent))});else switch(c.target.dataset.mode){case "ymdchange":c=document.querySelectorAll('[data-mode="ymdchange"][data-group="'+c.target.dataset.group+'"]');c[2].innerHTML=a.func.SelectYMD(c[0].value,c[1].value,1).d;break;case "sort":a.func.PlurkList(a.PlurkApi.plurks);break;case "porn":a.func.PlurkList(a.PlurkApi.plurks)}},ClickEvent:function(c){if(void 0===c)document.querySelectorAll('[data-event="ClickEvent"]').forEach(function(f){a.flag.ClickEventRegister=
a.flag.ClickEventRegister||[];-1===a.flag.ClickEventRegister.indexOf(f.id)&&(console.log("register ClickEvent"),a.flag.ClickEventRegister.push(f.id),f.addEventListener("click",a.func.ClickEvent))});else switch(c.target.dataset.mode){case "Search":document.querySelector('[data-mode="Search"]').setAttribute("disabled","");var b=a.PlurkApi;b.plurks=[];document.querySelector("#PlurkList").innerHTML="";a.flag.page=1;document.querySelector("#PageBar #page").value=a.flag.page;var e="",d="";c=document.querySelectorAll('select[data-mode="ymdchange"]');
e=c[3].value+"/"+c[4].value+"/"+c[5].value;d=c[0].value+"/"+c[1].value+"/"+c[2].value;if(new Date(e)<new Date(d)){document.querySelector("#Progress").innerHTML="\u958b\u59cb\u6642\u9593\u4e0d\u53ef\u5927\u65bc\u7d50\u679c\u6642\u9593";document.querySelector('[data-mode="Search"]').removeAttribute("disabled");break}b.act="Timeline/getPublicPlurks";b.arg.minimal_data="true";b.arg.minimal_user="true";b.arg.nick_name=document.querySelector("#nick_name").value;b.arg.limit="100";b.arg.only_user="true";
b.mode="CORS";e=(new Date(e)).setHours(32);d=(new Date(d)).setHours(8);b.arg.offset=(new Date(e)).toISOString();var k=0;b.func=function(f){b.plurks=b.plurks||[];f=JSON.parse(f.response);if(0===f.plurks.length)document.querySelector("#Progress").innerHTML=d+"~"+e+"\u671f\u9593\u641c\u5c0b\u5b8c\u6210,\u51710\u5657",document.querySelector('[data-mode="Search"]').removeAttribute("disabled");else if(b.plurks=b.plurks.concat(f.plurks),k++,k>a.config.loop_safe)console.log("loop_safe break");else{f=Math.floor((new Date(e)).getTime()/
1E3/60/60/24);var h=Math.floor((new Date(d)).getTime()/1E3/60/60/24),m=Math.floor((new Date(b.plurks[b.plurks.length-1].posted)).getTime()/1E3/60/60/24);f=Math.floor((f-h-(m-h))/(f-h)*100);document.querySelector("#Progress").innerHTML="\n                                \u641c\u5c0b\u4e2d\uff1a"+f+"%\n                                ("+(new Date(b.plurks[b.plurks.length-1].posted)).toISOString().split("T")[0]+")\n\n                            ";document.querySelector("#Progress").style.background=
"linear-gradient(to right, #0d0 "+f+"% , #999 0%)";(new Date(b.plurks[b.plurks.length-1].posted)).toISOString()>=(new Date(d)).toISOString()?setTimeout(function(){b.arg.offset=(new Date(new Date(b.plurks[b.plurks.length-1].posted))).toISOString();b.Send()},a.config.loop_sec):(console.log(a.PlurkApi.plurks),a.func.PlurkList(a.PlurkApi.plurks),document.querySelector('[data-mode="Search"]').removeAttribute("disabled"))}};a.DB.ref("PlurkSearch/count").once("value",function(f){a.DB.ref("PlurkSearch/count").set(f.val()+
1)});a.DB.ref("PlurkSearch/nick_name/"+document.querySelector("#nick_name").value).once("value",function(f){f=f.val()||0;a.DB.ref("PlurkSearch/nick_name/"+document.querySelector("#nick_name").value).set(f+1)}).then(function(f){200<=f.val()?alert("\u5df2\u9054\u67e5\u8a62\u4e0a\u9650,\u8acb\u806f\u7d61\u7cfb\u7d71\u7ba1\u7406\u54e1"):b.Send()});break;case "PageChange":c=c.target.dataset.path;var l=a.PlurkApi.search_plurks.length,g=parseInt(a.flag.page);"next"===c?a.flag.page=g+1:"prev"===c&&(a.flag.page=
g-1);a.flag.page>Math.ceil(l/a.config.page_per_count)||0>=a.flag.page*a.config.page_per_count||(document.querySelector("#PageBar #page").value=a.flag.page,document.querySelector("#PlurkList").scrollTo(0,0),a.func.PlurkList(a.PlurkApi.plurks),a.func.PageControl())}},StorageUpd:function(){localStorage[a.id]=JSON.stringify(a.flag.local);sessionStorage[a.id]=JSON.stringify(a.flag.session)},PlurkDate:function(c){return(new Date(c)).getFullYear()+"-"+((new Date(c)).getMonth()+1)+"-"+(new Date(c)).getDate()+
" "+(new Date(c)).getHours().toString().padStart(2,"0")+":"+(new Date(c)).getMinutes().toString().padStart(2,"0")+":"+(new Date(c)).getSeconds().toString().padStart(2,"0")}},ele:{},DB:{},firebase:function(c,b){if("undefined"===typeof firebase){var e=document.createElement("script");e.src="https://www.gstatic.com/firebasejs/5.5.6/firebase.js";document.head.appendChild(e);var d=setInterval(function(){"undefined"!==typeof firebase&&(a.DB=firebase,a.DB.initializeApp({databaseURL:c}),a.DB=a.DB.database(),
clearInterval(d),"function"===typeof b&&b())},100)}},js:function(c){var b={},e;for(e in c)b.$jscomp$loop$prop$i$3=e,setTimeout(function(k){return function(){var l=document.createElement("script");l.src=c[k.$jscomp$loop$prop$i$3]+"?s="+(new Date).getTime();document.head.appendChild(l)}}(b),200*b.$jscomp$loop$prop$i$3),b={$jscomp$loop$prop$i$3:b.$jscomp$loop$prop$i$3};var d=setInterval(function(){"function"===typeof PlurkApi&&(a.PlurkApi=new PlurkApi,clearInterval(d))},100)},css:function(c){c=$jscomp.makeIterator(c);
for(var b=c.next();!b.done;b=c.next()){b=b.value;var e=document.createElement("link");e.href=b+"?s="+(new Date).getTime();e.rel="stylesheet";e.type="text/css";document.head.appendChild(e)}},init:function(){a.firebase("https://kfs-plurk-default-rtdb.firebaseio.com/");a.js(["https://kfsshrimp.github.io/sha1/core-min.js","https://kfsshrimp.github.io/sha1/sha1-min.js","https://kfsshrimp.github.io/sha1/hmac-min.js","https://kfsshrimp.github.io/sha1/enc-base64-min.js","https://kfsshrimp.github.io/plurk/api.js"]);
a.css(["style.css"]);a.flag.local=JSON.parse(localStorage[a.id]||"{}");a.flag.session=JSON.parse(sessionStorage[a.id]||"{}");a.func.StorageUpd();document.body.innerHTML='\n            <div id="SearchBar">\n            <input id="nick_name" value="kfsshrimp4" type="text" placeholder="\u5657\u6d6a\u5e33\u865f">\n\n            <select id="y_start" data-group="ymd_start" data-mode="ymdchange" data-event="ChangeEvent">'+a.func.SelectYMD().y+'</select>\n            <select id="m_start" data-group="ymd_start" data-mode="ymdchange" data-event="ChangeEvent">'+
a.func.SelectYMD().m+'</select>\n            <select id="d_start" data-group="ymd_start" data-mode="ymdchange">'+a.func.SelectYMD().d+'</select>\n            ~\n            <select id="y_end" data-group="ymd_end" data-mode="ymdchange" data-event="ChangeEvent">'+a.func.SelectYMD().y+'</select>\n            <select id="m_end" data-group="ymd_end" data-mode="ymdchange" data-event="ChangeEvent">'+a.func.SelectYMD().m+'</select>\n            <select id="d_end" data-group="ymd_end" data-mode="ymdchange">'+
a.func.SelectYMD().d+'</select>\n\n            <select id="sort" data-mode="sort" data-event="ChangeEvent">'+a.func.SelectHtml(a.config.sort)+'</select>\n            <select id="porn" data-mode="porn" data-event="ChangeEvent">'+a.func.SelectHtml(a.config.porn)+'</select>\n\n            <input data-event="ClickEvent" data-mode="Search" type="button" value="\u641c\u5c0b">\n\n            </div>\n\n            <div id="Progress"></div>\n\n            <div id="PlurkList"></div>\n\n            <div id="PageBar">\n            <input id="prev"\n            data-event="ClickEvent"\n            data-mode="PageChange"\n            data-path="prev" disabled\n            type="button" value="\u4e0a\u4e00\u9801">\n\n            <input id="page" type="button" value="1">\n\n            <input id="next"\n            data-event="ClickEvent"\n            data-mode="PageChange"\n            data-path="next" disabled\n            type="button" value="\u4e0b\u4e00\u9801">\n            </div>';
a.func.ChangeEvent();a.func.ClickEvent();a.func.Block(1)}};window.onload=function(){a.init()}})();